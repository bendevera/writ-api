(this["webpackJsonpwrit-frontend"]=this["webpackJsonpwrit-frontend"]||[]).push([[0],{26:function(e,t,a){e.exports=a(39)},31:function(e,t,a){},37:function(e,t,a){},38:function(e,t,a){},39:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(21),o=a.n(s),c=(a(31),a(25)),l=a(4),i=a(5),u=a(7),m=a(6),h=a(8),d=a(10),b=a(2),p=Object(b.a)({}),g=a(12),v=function(e){return e.auth?r.a.createElement("nav",{className:"navbar navbar-light bg-light justify-content-between"},r.a.createElement(g.a,{to:"/"},r.a.createElement("span",{className:"navbar-brand mb-0 h1"},r.a.createElement("i",{className:"fas fa-code-branch"})," writ")),r.a.createElement("div",{className:"row"},r.a.createElement(g.a,{to:"/works"},r.a.createElement("span",{className:"nav-link"},"Works")),r.a.createElement("span",{className:"nav-link",onClick:e.signalLogout},"Logout"))):r.a.createElement("nav",{className:"navbar navbar-light bg-light justify-content-between"},r.a.createElement(g.a,{to:"/"},r.a.createElement("span",{className:"navbar-brand mb-0 h1"},r.a.createElement("i",{className:"fas fa-code-branch"})," writ")),r.a.createElement("div",{className:"row"},r.a.createElement(g.a,{to:"/login"},r.a.createElement("span",{className:"nav-link"},"Login")),r.a.createElement(g.a,{to:"/register"},r.a.createElement("span",{className:"nav-link"},"Register"))))},f=function(e){return r.a.createElement("div",{className:"fluid-container"},r.a.createElement("div",{className:"jumbotron my-jumbo"},r.a.createElement("h1",{className:"display-4"},"Welcome to writ."),r.a.createElement("p",{className:"lead"},"We're a version control system for literary works."),r.a.createElement("hr",{className:"my-4"}),r.a.createElement("p",null,"Sign up, and get to writing freely and cleanly."),r.a.createElement(g.a,{className:"btn btn-outline-dark btn-lg",to:"/register"},"Register")))},E=a(9),N=a(13),k=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).handleChange=function(e){var t=e.target.value;a.setState(Object(N.a)({},a.state,Object(E.a)({},e.target.name,t)))},a.handleSubmit=function(e){e.preventDefault(),a.props.sendRegister(a.state.email,a.state.password)},a.state={email:"",password:""},a}return Object(h.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e;return e=this.props.error?r.a.createElement("div",{className:"alert alert-danger"},this.props.error):r.a.createElement("div",null),r.a.createElement("div",{className:"container my-2"},r.a.createElement("h2",null,"Register an account."),r.a.createElement("form",null,r.a.createElement("div",{className:"form-group"},r.a.createElement("label",null,"Email address"),r.a.createElement("input",{name:"email",onChange:this.handleChange,type:"email",className:"form-control"}),r.a.createElement("small",{className:"form-text text-muted"},"We'll never share your email with anyone else.")),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",null,"Password"),r.a.createElement("input",{name:"password",onChange:this.handleChange,type:"password",className:"form-control"})),e,r.a.createElement("button",{className:"btn btn-outline-dark",onClick:this.handleSubmit},"Submit")))}}]),t}(r.a.Component),w=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).handleChange=function(e){var t=e.target.value;a.setState(Object(N.a)({},a.state,Object(E.a)({},e.target.name,t)))},a.handleSubmit=function(e){e.preventDefault(),a.props.sendLogin(a.state.email,a.state.password)},a.state={email:"",password:""},a}return Object(h.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e;return e=this.props.error?r.a.createElement("div",{className:"alert alert-danger"},this.props.error):r.a.createElement("div",null),r.a.createElement("div",{className:"container my-2"},r.a.createElement("h2",null,"Login to your account."),r.a.createElement("form",null,r.a.createElement("div",{className:"form-group"},r.a.createElement("label",null,"Email address"),r.a.createElement("input",{name:"email",onChange:this.handleChange,type:"email",className:"form-control"})),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",null,"Password"),r.a.createElement("input",{name:"password",onChange:this.handleChange,type:"password",className:"form-control"})),e,r.a.createElement("button",{className:"btn btn-outline-dark",onClick:this.handleSubmit},"Submit")))}}]),t}(r.a.Component),C=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).handleClick=function(e){a.props.focusWork(e.target.getAttribute("value"))},a}return Object(h.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.props.fetchData()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row justify-content-between my-3 px-3"},r.a.createElement("h2",null,r.a.createElement("i",{className:"fas fa-sticky-note"})," My Works."),r.a.createElement("i",{className:"fas fa-plus fa-2x add-work",onClick:this.props.addWork})),r.a.createElement("table",{className:"table table-hover"},r.a.createElement("thead",{className:"thead-dark"},r.a.createElement("tr",null,r.a.createElement("th",{scope:"col"},"Name"),r.a.createElement("th",{scope:"col"},"Created"),r.a.createElement("th",{scope:"col"},"Last Updated"),r.a.createElement("th",{scope:"col"},"# Versions"))),r.a.createElement("tbody",null,this.props.data.map((function(t,a){return console.log(a,t),r.a.createElement("tr",{className:"my-table-elem",key:t.id,onClick:e.handleClick},r.a.createElement("th",{value:t.id},t.title),r.a.createElement("td",{value:t.id},t.created),r.a.createElement("td",{value:t.id},t.last_updated),r.a.createElement("td",{value:t.id},t.newest_version))})))))}}]),t}(r.a.Component),y=a(24),S=(a(37),function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).handleChange=function(e){var t=e.target.value;if("text"==e.target.name){var n,r=a.state.versions;a.state.versions.map((function(e,n){e.number==a.state.currNum&&(r[n].text=t,r[n].unsavedChanges=!0)})),a.setState(Object(N.a)({},a.state,(n={},Object(E.a)(n,e.target.name,t),Object(E.a)(n,"versions",r),n)))}else a.setState(Object(N.a)({},a.state,Object(E.a)({},e.target.name,t)))},a.handleTextsChange=function(e){var t=e.target.value,n=a.state.texts,r=a.state.versions;"text-one"==e.target.name?(a.state.versions.map((function(e,n){e.number==a.state.currNums.one&&(r[n].text=t,r[n].unsavedChanges=!0)})),n.one=t):(a.state.versions.map((function(e,n){e.number==a.state.currNums.two&&(r[n].text=t,r[n].unsavedChanges=!0)})),n.two=t);var s=Object(y.diffChars)(n.one,n.two);console.log("DIFF CHARS"),console.log(s),a.setState({texts:n,versions:r})},a.versionChange=function(e){var t=e.target.getAttribute("value");a.state.versions.map((function(e){if(e.number==t)if(console.log(e.text),"Comparison"===a.state.mode){var n=a.state.currNums;n.two=n.one,n.one=e.number;var r=a.state.texts;r.two=r.one,r.one=e.text,a.setState({currNums:n,texts:r})}else a.setState({currNum:e.number,text:e.text})}))},a.handleSave=function(e){var t=a.state.versions;if("Comparison"===a.state.mode){var n={workId:a.state.workId,title:a.state.title,text:a.state.texts.one,number:a.state.currNums.one};a.props.sendSave(n);var r={workId:a.state.workId,title:a.state.title,text:a.state.texts.two,number:a.state.currNums.two};a.props.sendSave(r),a.state.versions.map((function(e,n){e.number!=a.state.currNums.one&&e.number!=a.state.currNums.two||(t[n].unsavedChanges=!1)})),a.setState({versions:t})}else{var s={workId:a.state.workId,title:a.state.title,text:a.state.text,number:a.state.currNum};a.props.sendSave(s),a.state.versions.map((function(e,n){e.number==a.state.currNum&&(t[n].unsavedChanges=!1)})),a.setState({versions:t})}},a.handleNew=function(e){a.props.createVersion(a.state.workId,a.state.currNum)},a.handleDelete=function(e){if(1==a.state.versions.length)alert("Can't delete the last version of a Work.");else{a.props.removeVersion(a.state.workId,a.state.currNum);for(var t=a.state.versions,n=0,r=0;r<t.length;r++)t[r].number==a.state.currNum?n=r:t[r].number>a.state.currNum&&(t[r].number=t[r].number-1);t.splice(n,1),a.setState({versions:t,text:t[0].text,currNum:t[0].number})}},a.changeMode=function(e){var t="Single"===a.state.mode?"Comparison":"Single";if("Comparison"===t){var n={};a.state.versions.map((function(e){e.number==a.state.currNums.one?n.one=e.text:e.number==a.state.currNums.two&&(n.two=e.text)})),a.setState({mode:t,texts:n})}else a.setState({mode:t})},console.log(a.props.data),a.state={title:a.props.title,versions:a.props.versions,workId:a.props.workId,mode:"Single",text:a.props.text,currNum:a.props.currNum,texts:{one:a.props.texts.one,two:a.props.texts.two},currNums:{one:a.props.currNums.one,two:a.props.currNums.two}},a}return Object(h.a)(t,e),Object(i.a)(t,[{key:"componentWillReceiveProps",value:function(e){console.log("Receiving props"),console.log(e),(e.text!=this.props.text||e.versions.length>this.props.versions.length)&&(console.log("Setting..."),this.setState({workId:e.workId,title:e.title,text:e.text,currNum:e.currNum,versions:e.versions})),null==e.workId&&(console.log("HAVE NULL workID"),p.push("/works"))}},{key:"render",value:function(){var e,t=this;return"Single"==this.state.mode?(e=this.state.versions.length>1?r.a.createElement("div",{className:"btn-group"},r.a.createElement("button",{className:"btn btn-dark active"},"Single"),r.a.createElement("button",{className:"btn btn-light",onClick:this.changeMode},"Comparison")):r.a.createElement("div",{className:"btn-group"},r.a.createElement("button",{className:"btn btn-dark active"},"Single"),r.a.createElement("button",{className:"btn btn-light disabled"},"Comparison")),r.a.createElement("div",{className:"container my-2"},r.a.createElement("div",{className:"btn-toolbar justify-content-between"},e,r.a.createElement("div",{className:"btn-group"},this.state.versions.map((function(e){return e.number==t.state.currNum?e.unsavedChanges?r.a.createElement("button",{className:"btn btn-light",key:e.number,value:e.number,onClick:t.versionChange},"V",e.number," ",r.a.createElement("span",{style:{color:"Tomato"}},r.a.createElement("i",{className:"fas fa-dot-circle"})),"  ",r.a.createElement("span",{value:e.number,className:"badge badge-secondary font-italic"},"edited")):r.a.createElement("button",{className:"btn btn-light",key:e.number,value:e.number,onClick:t.versionChange},"V",e.number," ",r.a.createElement("span",{style:{color:"Tomato"}},r.a.createElement("i",{className:"fas fa-dot-circle"}))):e.unsavedChanges?r.a.createElement("button",{className:"btn btn-dark",key:e.number,value:e.number,onClick:t.versionChange},"V",e.number," ",r.a.createElement("span",{value:e.number,className:"badge badge-secondary font-italic"},"edited")):r.a.createElement("button",{className:"btn btn-dark",key:e.number,value:e.number,onClick:t.versionChange},"V",e.number)}))),r.a.createElement("div",{className:"btn-group"},r.a.createElement("button",{className:"btn",onClick:this.handleDelete},r.a.createElement("i",{className:"fas fa-trash-alt"})),r.a.createElement("button",{className:"btn",onClick:this.handleSave},r.a.createElement("i",{className:"fas fa-save"})),r.a.createElement("button",{className:"btn",onClick:this.handleNew},r.a.createElement("i",{className:"fas fa-copy"})))),r.a.createElement("input",{name:"title",value:this.state.title,className:"version-title",onChange:this.handleChange}),r.a.createElement("textarea",{name:"text",className:"version-text bg-light",value:this.state.text,onChange:this.handleChange}))):r.a.createElement("div",{className:"container my-2"},r.a.createElement("div",{className:"btn-toolbar justify-content-between"},r.a.createElement("div",{className:"btn-group"},r.a.createElement("button",{className:"btn btn-light",onClick:this.changeMode},"Single"),r.a.createElement("button",{className:"btn btn-dark active"},"Comparison")),r.a.createElement("div",{className:"btn-group"},this.state.versions.map((function(e){return e.number==t.state.currNums.one||e.number==t.state.currNums.two?e.unsavedChanges?r.a.createElement("button",{className:"btn btn-light",key:e.number,value:e.number,onClick:t.versionChange},"V",e.number," ",r.a.createElement("span",{style:{color:"Tomato"}},r.a.createElement("i",{className:"fas fa-dot-circle"})),"  ",r.a.createElement("span",{value:e.number,className:"badge badge-secondary font-italic"},"edited")):r.a.createElement("button",{className:"btn btn-light",key:e.number,value:e.number,onClick:t.versionChange},"V",e.number," ",r.a.createElement("span",{style:{color:"Tomato"}},r.a.createElement("i",{className:"fas fa-dot-circle"}))):e.unsavedChanges?r.a.createElement("button",{className:"btn btn-dark",key:e.number,value:e.number,onClick:t.versionChange},"V",e.number," ",r.a.createElement("span",{value:e.number,className:"badge badge-secondary font-italic"},"edited")):r.a.createElement("button",{className:"btn btn-dark",key:e.number,value:e.number,onClick:t.versionChange},"V",e.number)}))),r.a.createElement("div",{className:"btn-group"},r.a.createElement("button",{className:"btn",onClick:this.handleSave},r.a.createElement("i",{className:"fas fa-save"})))),r.a.createElement("input",{name:"title",value:this.state.title,className:"version-title",onChange:this.handleChange}),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col"},r.a.createElement("textarea",{name:"text-one",className:"version-text bg-light",value:this.state.texts.one,onChange:this.handleTextsChange})),r.a.createElement("div",{className:"col"},r.a.createElement("textarea",{name:"text-two",className:"version-text bg-light",value:this.state.texts.two,onChange:this.handleTextsChange}))))}}]),t}(r.a.Component)),x={apiURL:"http://localhost:5000"};function j(){return localStorage.getItem("writToken")}function O(){return"?token="+j()}a(38);var R=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).handleLogin=function(e,t){(function(e,t){return new Promise((function(a,n){fetch(x.apiURL+"/auth/login",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}).then((function(e){return e.json()})).then((function(e){console.log(e),"success"==e.status&&(localStorage.setItem("writToken",e.auth_token),a("Logged in.")),n(e.message)})).catch((function(e){console.log(e),n("Error with request. Please try again.")}))}))})(e,t).then((function(e){console.log("Should push /works"),p.push("/works"),a.setState({authenticated:!0})})).catch((function(e){console.log(e),a.setState({error:e})}))},a.handleLogout=function(){localStorage.removeItem("writToken"),a.setState({authenticated:!1}),p.push("/login")},a.handleRegister=function(e,t){(function(e,t){return new Promise((function(a,n){fetch(x.apiURL+"/auth/register",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}).then((function(e){return e.json()})).then((function(e){"success"==e.status&&(localStorage.setItem("writToken",e.auth_token),a("Logged in.")),n(e.message)})).catch((function(e){console.log(e),n("Error with request. Please try again.")}))}))})(e,t).then((function(e){console.log("Should push /works"),p.push("/works"),a.setState({authenticated:!0})})).catch((function(e){console.log(e),a.setState({error:e})}))},a.getMyWorks=function(){new Promise((function(e,t){fetch(x.apiURL+"/works"+O()).then((function(e){return e.json()})).then((function(a){"success"==a.status?e(a.data):t(a.message)}))})).then((function(e){a.setState({works:e,authenticated:!0})})).catch((function(e){console.log("ERROR")}))},a.createWork=function(){new Promise((function(e,t){fetch(x.apiURL+"/works"+O(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({token:j()})}).then((function(e){return e.json()})).then((function(t){e(t.data)})).catch((function(e){t(e)}))})).then((function(e){var t=a.state.works;t.push(e),a.setState({works:t})})).catch((function(e){console.log("ERROR MAKING WORK")}))},a.focusOnWork=function(e){a.state.works.map((function(t){t.id==e&&(a.setState({currWorkId:t.id,currTitle:t.title,currText:t.versions[0].text,currNum:t.versions[0].number,currVersions:t.versions}),p.push("/version"))}))},a.sendSave=function(e){(function(e){return new Promise((function(t,a){fetch(x.apiURL+"/works/"+e.workId.toString()+"/versions/"+e.number.toString()+O(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({title:e.title,text:e.text})}).then((function(e){return e.json()})).then((function(e){t(e.data)})).catch((function(e){a(e)}))}))})(e).then((function(e){console.log("RESULT OF SAVE"),console.log(e)}))},a.createVersion=function(e,t){(function(e,t){return new Promise((function(a,n){console.log(x.apiURL+"/works/"+e.toString()+O()),fetch(x.apiURL+"/works/"+e.toString()+"/versions"+O(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({number:t})}).then((function(e){return e.json()})).then((function(e){a(e.data)})).catch((function(e){n(e)}))}))})(e,t).then((function(e){console.log(e),a.setState({currNum:e.number,currText:e.text,currVersions:[].concat(Object(c.a)(a.state.currVersions),[e])})}))},a.removeVersion=function(e,t){(function(e,t){return new Promise((function(a,n){fetch(x.apiURL+"/works/"+e.toString()+"/versions/"+t.toString()+O(),{method:"DELETE"}).then((function(e){return e.json()})).then((function(e){a(e.data)})).catch((function(e){n(e)}))}))})(e,t).then((function(e){console.log("DELETED"),console.log(e)})).catch((function(e){console.log("ERROR DELETING")}))},a.state={authenticated:!1,works:[],error:null,temp_version_data:{title:"Untitled",text:"This is a test"},currWorkId:null,currTitle:"",currText:"",currVersions:[],currNum:1,texts:{one:"",two:""},currNums:{one:1,two:2}},a}return Object(h.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this;new Promise((function(e,t){fetch(x.apiURL+"/auth/status"+O()).then((function(e){return e.json()})).then((function(t){"success"==t.status?e(!0):e(!1)})).catch((function(e){t(e)}))})).then((function(t){console.log("RESULT"),console.log(t),t&&e.setState({authenticated:!0})})).catch((function(e){console.log("ERROR CEHCK"),console.log(e)}))}},{key:"render",value:function(){var e=this;return r.a.createElement(d.b,{history:p},r.a.createElement("div",{className:"App"},r.a.createElement(v,{auth:this.state.authenticated,signalLogout:this.handleLogout}),r.a.createElement(d.a,{exact:!0,path:"/",component:f}),r.a.createElement(d.a,{path:"/register",render:function(t){return r.a.createElement(k,Object.assign({},t,{sendRegister:e.handleRegister,error:e.state.error}))}}),r.a.createElement(d.a,{path:"/login",render:function(t){return r.a.createElement(w,Object.assign({},t,{sendLogin:e.handleLogin,error:e.state.error}))}}),r.a.createElement(d.a,{path:"/works",render:function(t){return r.a.createElement(C,Object.assign({},t,{data:e.state.works,fetchData:e.getMyWorks,addWork:e.createWork,focusWork:e.focusOnWork}))}}),r.a.createElement(d.a,{path:"/version",render:function(t){return r.a.createElement(S,Object.assign({},t,{workId:e.state.currWorkId,title:e.state.currTitle,text:e.state.currText,currNum:e.state.currNum,versions:e.state.currVersions,sendSave:e.sendSave,createVersion:e.createVersion,removeVersion:e.removeVersion,texts:e.state.texts,currNums:e.state.currNums}))}})))}}]),t}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(R,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[26,1,2]]]);
//# sourceMappingURL=main.c48a8a66.chunk.js.map